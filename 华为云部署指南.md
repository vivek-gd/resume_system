# 华为云部署指南

## 1. 准备工作

### 1.1 确认华为云服务器信息
- 弹性公网IP: 124.70.156.195
- 系统用户名: root
- 确保服务器操作系统为Linux（推荐Ubuntu 20.04或CentOS 7+）

### 1.2 本地准备
在本地电脑上，将项目打包：
```bash
# 在项目根目录执行
tar -czf resume-system.tar.gz .
```

## 2. 连接到华为云服务器

### 2.1 使用SSH连接
```bash
ssh root@124.70.156.195
# 输入密码登录
```

### 2.2 如果使用密钥对登录
```bash
ssh -i /path/to/your-key.pem root@124.70.156.195
```

## 3. 安装系统依赖

### 3.1 Ubuntu/Debian系统
```bash
# 更新软件源
sudo apt-get update

# 安装Python和pip
sudo apt-get install -y python3 python3-pip python3-venv

# 安装Nginx
sudo apt-get install -y nginx

# 安装wkhtmltopdf（用于PDF导出）
sudo apt-get install -y wkhtmltopdf

# 安装其他必要工具
sudo apt-get install -y git curl wget
```

### 3.2 CentOS/RHEL系统
```bash
# 更新软件源
sudo yum update -y

# 安装Python和pip
sudo yum install -y python3 python3-pip

# 安装Nginx
sudo yum install -y nginx

# 安装wkhtmltopdf
sudo yum install -y wkhtmltopdf

# 安装其他必要工具
sudo yum install -y git curl wget
```

## 4. 上传项目到服务器

### 4.1 使用SCP上传
在本地电脑执行：
```bash
scp resume-system.tar.gz root@124.70.156.195:/root/
```

### 4.2 在服务器上解压
```bash
# 登录服务器后执行
cd /root/
tar -xzf resume-system.tar.gz

# 重命名目录为resume-system（如果需要）
mv resume-system resume-system

# 进入项目目录
cd /root/resume-system
```

## 5. 配置Python环境

### 5.1 创建虚拟环境
```bash
cd /root/resume-system
python3 -m venv venv
source venv/bin/activate
```

### 5.2 安装Python依赖
```bash
# 升级pip
pip install --upgrade pip

# 安装项目依赖
pip install -r requirements.txt

# 安装Gunicorn（生产环境Web服务器）
pip install gunicorn
```

## 6. 配置应用

### 6.1 修改管理员密码
```bash
# 编辑app.py文件
nano app.py

# 找到第24行，修改密码
app.config['EDITS_PASSWORD'] = 'your_strong_password_here'

# 保存并退出（Ctrl+X，然后Y，然后Enter）
```

### 6.2 配置防火墙
```bash
# Ubuntu/Debian
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# CentOS/RHEL
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

### 6.3 在华为云安全组中开放端口
1. 登录华为云控制台
2. 进入"弹性云服务器" -> "安全组"
3. 找到对应的安全组，添加入方向规则：
   - 端口: 80, 协议: TCP, 源地址: 0.0.0.0/0
   - 端口: 443, 协议: TCP, 源地址: 0.0.0.0/0

## 7. 测试运行

### 7.1 直接使用Python运行测试
```bash
cd /root/resume-system
source venv/bin/activate
python app.py
```

### 7.2 访问测试
在浏览器中访问：http://124.70.156.195:5000

如果看到简历系统页面，说明应用运行正常。按Ctrl+C停止测试运行。

## 8. 使用Gunicorn生产部署

### 8.1 使用Gunicorn启动
```bash
cd /root/resume-system
source venv/bin/activate

# 使用4个工作进程启动
nohup gunicorn -w 4 -b 0.0.0.0:5000 app:app > app.log 2>&1 &
```

### 8.2 查看运行状态
```bash
# 查看进程
ps aux | grep gunicorn

# 查看日志
tail -f app.log
```

### 8.3 设置开机自启
创建systemd服务文件：
```bash
sudo nano /etc/systemd/system/resume.service
```

添加以下内容：
```ini
[Unit]
Description=Resume System
After=network.target

[Service]
User=root
WorkingDirectory=/root/resume-system
Environment="PATH=/root/resume-system/venv/bin"
ExecStart=/root/resume-system/venv/bin/gunicorn -w 4 -b 0.0.0.0:5000 app:app
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

启用服务：
```bash
sudo systemctl daemon-reload
sudo systemctl enable resume
sudo systemctl start resume
sudo systemctl status resume
```

## 9. 配置Nginx反向代理

### 9.1 创建Nginx配置文件
```bash
# Ubuntu/Debian
sudo nano /etc/nginx/sites-available/resume

# CentOS/RHEL
sudo nano /etc/nginx/conf.d/resume.conf
```

添加以下配置：
```nginx
server {
    listen 80;
    server_name 124.70.156.195;

    client_max_body_size 20M;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
    }

    location /static {
        alias /root/resume-system/static;
        expires 30d;
    }
}
```

### 9.2 启用配置
```bash
# Ubuntu/Debian
sudo ln -s /etc/nginx/sites-available/resume /etc/nginx/sites-enabled/

# 测试配置
sudo nginx -t

# 重启Nginx
sudo systemctl restart nginx
sudo systemctl enable nginx
```

### 9.3 测试访问
在浏览器中访问：http://124.70.156.195

## 10. 配置SSL证书（HTTPS）

### 10.1 安装Certbot
```bash
# Ubuntu/Debian
sudo apt-get install -y certbot python3-certbot-nginx

# CentOS/RHEL
sudo yum install -y certbot python3-certbot-nginx
```

### 10.2 获取SSL证书
如果你有域名，将域名解析到124.70.156.195，然后执行：
```bash
sudo certbot --nginx -d your-domain.com
```

### 10.3 自动续期
```bash
# 测试续期
sudo certbot renew --dry-run

# Certbot会自动设置续期任务
```

## 11. 维护和监控

### 11.1 查看日志
```bash
# 应用日志
tail -f /root/resume-system/app.log

# Nginx访问日志
sudo tail -f /var/log/nginx/access.log

# Nginx错误日志
sudo tail -f /var/log/nginx/error.log
```

### 11.2 重启服务
```bash
# 重启应用服务
sudo systemctl restart resume

# 重启Nginx
sudo systemctl restart nginx
```

### 11.3 备份数据
```bash
# 创建备份脚本
nano /root/backup-resume.sh
```

添加以下内容：
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/root/backups"
mkdir -p $BACKUP_DIR

# 备份数据库
cp /root/resume-system/resume.db $BACKUP_DIR/resume_$DATE.db

# 备份静态文件
tar -czf $BACKUP_DIR/static_$DATE.tar.gz /root/resume-system/static

# 删除7天前的备份
find $BACKUP_DIR -name "resume_*.db" -mtime +7 -delete
find $BACKUP_DIR -name "static_*.tar.gz" -mtime +7 -delete

echo "Backup completed at $DATE"
```

设置定时备份：
```bash
chmod +x /root/backup-resume.sh

# 添加到crontab（每天凌晨3点执行）
crontab -e

# 添加以下行
0 3 * * * /root/backup-resume.sh >> /var/log/backup.log 2>&1
```

## 12. 故障排除

### 12.1 服务无法启动
```bash
# 检查端口占用
netstat -tunlp | grep 5000

# 检查服务状态
sudo systemctl status resume

# 查看日志
journalctl -u resume -f
```

### 12.2 PDF导出失败
```bash
# 确认wkhtmltopdf安装
wkhtmltopdf --version

# 测试PDF导出
wkhtmltopdf http://www.google.com /tmp/test.pdf
```

### 12.3 文件上传失败
```bash
# 检查目录权限
chmod -R 755 /root/resume-system/static

# 检查磁盘空间
df -h
```

## 13. 访问地址

部署完成后，你可以通过以下地址访问：

- **查看简历**: http://124.70.156.195/
- **管理登录**: http://124.70.156.195/login (用户名: admin)
- **编辑简历**: http://124.70.156.195/edit
- **版本历史**: http://124.70.156.195/history

## 14. 安全建议

1. 定期更新系统和软件包
2. 使用强密码
3. 配置防火墙规则
4. 启用HTTPS
5. 定期备份数据
6. 监控系统日志
7. 限制SSH登录（可以设置只允许密钥登录）

部署完成后，你的简历管理系统就可以在华为云上正常运行了！
